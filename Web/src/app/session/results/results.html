@if(session && session.session) {
<h3 class="mb-0">Results</h3>
@if(isRace) {
<div class="mb-2"><small class="fst-italic">Only accurate to last completed lap</small></div>
} @else {
<div class="mb-2"><small class="fst-italic">Fastest recorded laps</small></div>
}
<table class="table table-sm table-striped table-hover">
    <thead>
        <tr>
            <th scope="col" class="text-center">Status</th>
            <th scope="col" class="text-center">Pos</th>
            <th scope="col" class="text-center">PIC</th>
            <th scope="col" class="text-center">Class</th>
            <th scope="col" class="text-center">#</th>
            <th scope="col" class="team-col">Team</th>
            <th scope="col" class="driver-col">Driver</th>
            <th scope="col" class="text-end">Laps</th>
            @if(isRace) {
            <th scope="col" class="text-end time-col">Last</th>
            } @else {
            <th scope="col" class="text-end time-col">Behind</th>
            <th scope="col" class="text-end time-col">Int</th>
            <th scope="col" class="text-end time-col">Time</th>
            }
            <th scope="col" class="text-end time-col">S1</th>
            <th scope="col" class="text-end time-col">S2</th>
            <th scope="col" class="text-end time-col">S3</th>
            <th scope="col" class="text-end time-col">Fuel</th>
        </tr>
    </thead>
    <tbody>
        @for (lap of results; track CarKey.fromCar(lap.car).id; let i = $index) {
        @let id = CarKey.fromCar(lap.car).id;
        @let car = lap.car;
        @let carClass = (car && car.class ? car.class : '') ?? '';
        @if(car) {
        <tr>
            @let status = Format.status(lap);
            @let statusClass = status == 'Run' ? 'link-success' : status == 'Req' ? 'link-info' : status == 'Out' ? 'link-warning' : status == 'In' || status == 'Pit' ? 'link-danger' : 'link-secondary';
            <td class="text-center"><a class="{{ statusClass }}" [routerLink]="['Laps', `${id}`]">{{ status }}</a></td>
            @let classId = Utils.classId(carClass);
            <td class="text-center {{ positionInClass.get(id ?? '') == 1 ? `pic-${classId}` : null }}">{{ i + 1 }}</td>
            <td class="text-center pic-{{ classId }}">{{ positionInClass.get(id ?? '') }}</td>
            <td class="text-center"><app-session-class-badge [carClass]="carClass" /></td>
            <td class="text-center">{{ car?.number ? car.number : '' }}</td>
            <td class="team-col text-truncate" title="{{ car?.teamName }}">{{ car?.teamName ? car.teamName : '' }}</td>
            <td class="driver-col text-truncate" title="{{ lap.driver }}">{{ lap.driver }}</td>
            <td class="text-end">{{ lap.lapNumber }}</td>
            @if(!isRace) {
            <td class="text-end time-col">{{ gaps[i].behind <= 0 ? '-' : Format.diff(0, gaps[i].behind) }}</td>
            <td class="text-end time-col">{{ gaps[i].interval <= 0 ? '-' : Format.diff(0, gaps[i].interval) }}</td>
            }
            <td class="text-end time-col">{{ Format.lapTime(lap.totalTime) }}</td>
            <td class="text-end time-col">{{ Format.lapTime(lap.sector1) }}</td>
            <td class="text-end time-col">{{ Format.lapTime(lap.sector2) }}</td>
            <td class="text-end time-col">{{ Format.lapTime(lap.sector2) }}</td>
            @let fuelClass = lap.fuel > .1 ? '' : lap.fuel > .05 ? 'text-warning' : 'text-danger';
            <td class="text-end time-col {{ fuelClass }}">{{ Format.percent(lap.fuel) }}</td>
        </tr>
        }
        }
    </tbody>
</table>
} @else {
<p class="text-center">This session is not live. View the <a [routerLink]="['History']">history</a> instead.</p>
}
