@if(model && model.session && model.car) {
<dl class="row">
    <dt class="col-lg-1 col-2">Session</dt>
    <dd class="col-lg-3 col-3"><a [routerLink]="['/', 'Session', model.session.sessionId]">{{ Format.date(model.session.timestamp) }}</a></dd>
    <dt class="col-lg-1 col-2">Session</dt>
    <dd class="col-lg-2 col-5">{{ model.session.type }}</dd>
    <dt class="col-lg-1 col-2">Track</dt>
    <dd class="col-lg-4 col-10">{{ model.session.track }}</dd>
    <dt class="col-lg-1 col-2">Slot ID</dt>
    <dd class="col-lg-1 col-3">{{ model.car.car.slotId }}</dd>
    <dt class="col-lg-1 col-2">Veh</dt>
    <dd class="col-lg-4 col-5">{{ model.car.car.veh }}</dd>
    <dt class="col-lg-1 col-2">Vehicle</dt>
    <dd class="col-lg-4 col-10">{{ model.car.car.vehicleName }}</dd>
    <dt class="col-lg-1 col-2">Number</dt>
    <dd class="col-lg-1 col-3">{{ model.car.car.number }}</dd>
    <dt class="col-lg-1 col-2">Class</dt>
    <dd class="col-lg-1 col-5"><app-session-class-badge [carClass]="model.car.car.class" /></dd>
    <dt class="col-lg-1 col-2">Team</dt>
    <dd class="col-lg-3 col-10">{{ model.car.car.teamName }}</dd>
    <dt class="col-lg-1 col-2">ID</dt>
    <dd class="col-lg-3 col-10 text-truncate">{{ model.car.car.id }}</dd>
</dl>

<div class="d-flex">
    <h3 class="flex-grow-1">Laps</h3>
    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#pitModal">Pit summary</button>
</div>
<table class="table table-sm table-striped table-hover">
    <thead>
        <tr>
            <th>Start ET</th>
            <th>Lap</th>
            <th title="Pit">P</th>
            <th title="Garage">G</th>
            <th title="Penalty">!</th>
            <th>Driver</th>
            <th class="text-end">Time</th>
            <th class="text-end">S1</th>
            <th class="text-end">S2</th>
            <th class="text-end">S3</th>
            <th class="text-end">Fuel</th>
        </tr>
    </thead>
    <tbody>
        @for(_ of [].constructor(model.car.laps.length); track i; let i = $index) {
        @let lap = model.car.laps[i] ?? defaultLap(i+1);
        @let bestClasses = getBestClasses(lap);
        <tr>
            <td>{{ lap.startTime <= 0 ? '-' : Format.time(lap.startTime) }}</td>
            <td>{{ lap.lapNumber }}</td>
            <td>{{ lap.pit ? 'P' : '' }}</td>
            <td>{{ lap.garage ? 'G' : '' }}</td>
            <td>{{ lap.penalty ? '!' : '' }}</td>
            <td>{{ lap.driver }}</td>
            <td class="text-end {{ bestClasses.total }}">{{ Format.lapTime(lap.totalTime) }}</td>
            <td class="text-end {{ bestClasses.sector1 }}">{{ Format.lapTime(lap.sector1) }}</td>
            <td class="text-end {{ bestClasses.sector2 }}">{{ Format.lapTime(lap.sector2) }}</td>
            <td class="text-end {{ bestClasses.sector3 }}">{{ Format.lapTime(lap.sector3) }}</td>
            <td class="text-end">{{ Format.percent(lap.fuel) }}</td>
        </tr>
        }
    </tbody>
</table>

<div class="modal fade" id="pitModal" tabindex="-1" aria-labelledby="pitModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="pitModalLabel">Pit summary</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <app-session-pit-summary [laps]="model" />
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

}
